(()=>{"use strict";var t,e,n={147:t=>{t.exports=require("fs")},17:t=>{t.exports=require("path")}},r={};function o(t){var e=r[t];if(void 0!==e)return e.exports;var i=r[t]={exports:{}};return n[t](i,i.exports,o),i.exports}window.onload=function(){var n,r,i=document.getElementById("code"),s=document.getElementById("console"),a=document.getElementById("canvas"),c=document.getElementById("version"),l=document.getElementById("run");i.addEventListener("keydown",(function(t){if("Tab"==t.key){t.preventDefault();let e=i.selectionStart||0,n=i.selectionEnd||0;i.value=i.value.substring(0,e)+"\t"+i.value.substring(n),i.selectionStart=i.selectionEnd=e+1}}));var u=document.getElementById("backward"),f=document.getElementById("forward"),d=null;function y(){d&&(u.disabled=d.cur_pos<=0,f.disabled=d.cur_pos>=d.history.length-1)}u.addEventListener("click",(function(){d&&d.backward()})),f.addEventListener("click",(function(){d&&d.forward()}));let m=document.getElementById("canvas_container");function _(t){null!=t&&null!=t&&(s.textContent+=t)}m&&(d=function(t,e,n,r,o,i,s,a){function c(t){l.x=t.clientX,l.y=t.clientY}var l={x:0,y:0,startX:0,startY:0},u=null,f=s,d=a,y=n,m=r,_=o,p=i,h=!1,x={history:Array(),cur_pos:-1,init:function(){h=!0,x.history=[],x.cur_pos=-1,g()},backward:function(){x.cur_pos>0&&(x.cur_pos-=1,v())},forward:function(){x.cur_pos<x.history.length-1&&(x.cur_pos+=1,v())}};function g(){let t=x.history.length-1-x.cur_pos;for(let e=0;e<t;e++)x.history.pop();x.history.push({x0:y,y0:m,x1:_,y1:p}),x.cur_pos+=1}function v(){let t=x.history[x.cur_pos];y=t.x0,m=t.y0,_=t.x1,p=t.y1,e(y,m,_,p)}function w(e){c(e),l.startX=l.x,l.startY=l.y,(u=document.createElement("div")).className="rectangle",u.style.left=l.x+"px",u.style.top=l.y+"px",t.appendChild(u),t.style.cursor="crosshair"}function b(t){if(c(t),null!==u){u.style.width=Math.abs(l.x-l.startX)+"px",u.style.height=Math.abs(l.y-l.startY)+"px";let t=l.x<l.startX?l.x:l.startX,e=l.y<l.startY?l.y:l.startY;t+=window.pageXOffset,e+=window.pageYOffset,u.style.left=t+"px",u.style.top=e+"px"}}function z(n){if(!u)return;t.removeChild(u),u=null,t.style.cursor="default";var r=t.getBoundingClientRect(),o=Math.min(l.startX,l.x)-r.left,i=Math.min(l.startY,l.y)-r.top,s=Math.max(l.startX,l.x)-r.left,a=Math.max(l.startY,l.y)-r.top,c=(_-y)/f,h=(p-m)/d;let x=y,v=m;y=x+c*o,m=v+h*i,_=x+c*s,p=v+h*a,g(),e(y,m,_,p)}return t.onmousemove=b,t.ontouchmove=function(t){1==t.touches.length&&b(t.touches[0])},t.ontouchstart=function(t){1==t.touches.length&&w(t.touches[0])},t.ontouchend=function(t){z()},t.onclick=function(e){h&&(3!=e.which?null!==u?z():w(e):u&&(t.removeChild(u),u=null))},x}(m,(function(t,e,n,o){(0,r.code_instance.exports.plot_mandelbrot_set)(t,e,n,o),y()}),-2,-1.2,1,1.2,400,300)),y(),i.value='print "plot a mandelbrot set"\n\nlet plot_mandelbrot_set x0:f64 y0:f64 x1:f64 y1:f64 =\n\tlet width = 400, height = 300\n\tvar a:u8[height][width * 4]\n\tlet scalex = (x1-x0)/width, scaley = (y1-y0)/height, max_iter = 510\n\tvar v = 0.0, r = 0.0, g = 0.0, b = 0.0\n\tfor x in 0..width\n\t\tfor y in 0..height\n\t\t\tlet cx = x0 + scalex*x\n\t\t\tlet cy = y0 + scaley*y\n\t\t\tvar zx = 0.0, zy = 0.0\n\t\t\tvar zx2 = 0.0, zy2 = 0.0\n\t\t\tvar n = 0\n\t\t\twhile n<max_iter && (zx2 + zy2) < 4.0\n\t\t\t\tzy = 2.0 * zx * zy + cy\n\t\t\t\tzx = zx2  - zy2 + cx\n\t\t\t\tzx2 = zx * zx\n\t\t\t\tzy2 = zy * zy\n\t\t\t\tn++\n\t\t\tif n < max_iter then\n\t\t\t\tv = (log(n+1.5-(log2((log(zx2+zy2))/2.0))))/3.4\n\t\t\t\tif v < 1.0 then \n\t\t\t\t\tr = v ** 4;g = v ** 2.5;b = v\n\t\t\t\telse\n\t\t\t\t\tv = v < 2.0 ? 2.0 - v : 0.0\n\t\t\t\t\tr = v;g = v ** 1.5;b = v ** 3.0\n\t\t\ta[y][4*x] = n == max_iter ? 0 : (u8)(r * 255)\n\t\t\ta[y][4*x+1] = n == max_iter ? 0 : (u8)(g * 255)\n\t\t\ta[y][4*x+2] = n == max_iter ? 0 : (u8)(b * 255)\n\t\t\ta[y][4*x+3] = 255\n\n\tsetImageData a width height\n\nplot_mandelbrot_set (-2.0) (-1.2) 1.0 1.2\n',function(n,r,i,s,a){var c,l,u=null;if(s)l=WebAssembly.instantiateStreaming(fetch(r),{wasi_snapshot_preview1:n});else{const t=o(147),e=o(17),i=t.readFileSync(e.resolve(__dirname,r));l=WebAssembly.instantiate(i,{wasi_snapshot_preview1:n})}return new Promise((function(r,o){l.then((function(o){t={run_code:y,compile:m,version:c,mw_instance:o.instance},e={malloc:o.instance.exports.malloc,free:o.instance.exports.free,compile_code:o.instance.exports.compile_code,get_code_size:o.instance.exports.get_code_size,get_version:o.instance.exports.version,strlen:o.instance.exports.strlen,putchar:o.instance.exports.putchar,print:o.instance.exports.print,pow:o.instance.exports.pow,log:o.instance.exports.log,log2:o.instance.exports.log2,memory:o.instance.exports.memory,__stack_pointer:o.instance.exports.__stack_pointer},function(){if(n.setEnv(e.memory,i),e.get_version){let t=e.get_version();c=function(t){const n=e.strlen(t);let r=new Uint8Array(e.memory.buffer,t,n);return(new TextDecoder).decode(r)}(t),e.free(t)}}(),r(t)})).catch((function(t){o(t)}))}));function f(t,n){let r=(new TextEncoder).encode(t),o=r.length+1,i=new Uint8Array(e.memory.buffer,n,o);i.set(r),i[r.length]=0}function d(t,n,r){if(null!=a&&null!=a){let o=new Uint8ClampedArray(e.memory.buffer,t,n*r*4);a(o,n,r)}}function y(n,r=!0){if(!t)return i("m loading is failed."),null;let o=e.malloc(10240);f(n,o);let s=e.compile_code(o),a=e.get_code_size();if(!a)return null;let c=function(t,n){let r=new Uint8Array(e.memory.buffer,t,n);var o=new WebAssembly.Module(r);const i=new WebAssembly.Global({value:"i32",mutable:!1},65536);return{start_result:(0,(u=new WebAssembly.Instance(o,{sys:{print:e.print,putchar:e.putchar,memory:e.memory,__memory_base:i,__stack_pointer:e.__stack_pointer,setImageData:d},math:{pow:e.pow,log2:e.log2,log:e.log}})).exports._start)(),code_instance:u,code_bytes:t}}(s,a);return r&&e.free(s),c}function m(t,n){let r=e.malloc(1024);f(t,r);let i=e.compile_code(r),s=e.get_code_size();if(!s)return;let a=new Uint8Array(e.memory.buffer,i,s);o(147).writeFileSync(n,a,"binary"),e.free(i)}}(function(){var t,e;function n(){return new DataView(t.buffer)}return{setEnv:function(n,r){t=n,e=r},environ_sizes_get:function(t,e){var r=n();return r.setUint32(t,0,!0),r.setUint32(e,0,!0),0},args_sizes_get:function(t,e){var r=n();return r.setUint32(t,0,!0),r.setUint32(e,0,!0),0},fd_prestat_get:function(t,e){return 8},fd_fdstat_get:function(t,e){var r=n();function o(t,e,n){var o=e;r.setUint32(n?0:4,o,n),r.setUint32(n?4:0,0,n)}return r.setUint8(e,t),r.setUint16(e+2,0,!0),r.setUint16(e+4,0,!0),o(0,0,!0),o(0,0,!0),0},fd_write:function(r,o,i,s){var a=n(),c=0,l=[];return function(e,n){return Array.from({length:n},(function(n,r){var o=e+8*r,i=a.getUint32(o,!0),s=a.getUint32(o+4,!0);return new Uint8Array(t.buffer,i,s)}))}(o,i).forEach((function(t){for(var e=0;e<t.byteLength;e++)l.push(t[e]);c+=e})),1===r&&e(function(t){var e,n,r,o,i,s;for(e="",r=t.length,n=0;n<r;)switch((o=t[n++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(o);break;case 12:case 13:i=t[n++],e+=String.fromCharCode((31&o)<<6|63&i);break;case 14:i=t[n++],s=t[n++],e+=String.fromCharCode((15&o)<<12|(63&i)<<6|(63&s)<<0)}return e}(l)),a.setUint32(s,c,!0),0},fd_prestat_dir_name:function(t,e,n){return 28},environ_get:function(t,e){return 0},args_get:function(t,e){return 0},poll_oneoff:function(t,e,n,r){return 52},proc_exit:function(t){return 52},fd_close:function(t){return 52},fd_seek:function(t,e,n,r){}}}(),"/mw.wasm",_,!0,(function(t,e,n){if(!a)return;let r=a.getContext("2d");if(!r)return;a.width=e,a.height=n;let o=r.createImageData(e,n);o.data.set(t),r.putImageData(o,0,0)})).then((t=>{var e;e=(n=t).version,c&&(c.textContent=e)})),l.addEventListener("click",(function(t){(function(){s.textContent="";const t=a.getContext("2d");t&&t.clearRect(0,0,a.width,a.height)})(),null!=r&&null!=r.code_bytes&&(0,n.mw_instance.exports.free)(r.code_bytes);let e=i.value;_((r=n.run_code(e,!1)).start_result),d&&(d.init(),y())}))}})();
//# sourceMappingURL=main.bundle.js.map