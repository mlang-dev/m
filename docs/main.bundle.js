var m;(()=>{"use strict";var t={147:t=>{t.exports=require("fs")},17:t=>{t.exports=require("path")}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};(()=>{var t,e,o,i;n.r(r);var a=null;function s(){a&&(document.getElementById("backward").disabled=a.cur_pos<=0,document.getElementById("forward").disabled=a.cur_pos>=a.history.length-1)}function c(t){let e=document.getElementById(o.text_id);e?e.textContent+=t:console.log("missing textDom: ",o.text_id)}(function(r,o,i,a,s){var c,l,u=null;return l=WebAssembly.instantiateStreaming(fetch(o),{wasi_snapshot_preview1:r}),new Promise((function(n,o){l.then((function(o){t={run_code:m,compile:y,version:c,mw_instance:o.instance,canvas_id:"",text_id:""},e={malloc:o.instance.exports.malloc,free:o.instance.exports.free,compile_code:o.instance.exports.compile_code,get_code_size:o.instance.exports.get_code_size,get_version:o.instance.exports.version,strlen:o.instance.exports.strlen,putchar:o.instance.exports.putchar,print:o.instance.exports.print,pow:o.instance.exports.pow,log:o.instance.exports.log,log2:o.instance.exports.log2,memory:o.instance.exports.memory,__stack_pointer:o.instance.exports.__stack_pointer},function(){if(r.setEnv(e.memory,i),e.get_version){let t=e.get_version();c=function(t){const n=e.strlen(t);let r=new Uint8Array(e.memory.buffer,t,n);return(new TextDecoder).decode(r)}(t),e.free(t)}}(),n(t)})).catch((function(t){o(t)}))}));function f(t,n){let r=(new TextEncoder).encode(t),o=r.length+1,i=new Uint8Array(e.memory.buffer,n,o);i.set(r),i[r.length]=0}function d(t,n,r){if(null!=s&&null!=s){let o=new Uint8ClampedArray(e.memory.buffer,t,n*r*4);s(o,n,r)}}function m(n,r=!0){if(!t)return i("m loading is failed."),null;let o=e.malloc(10240);f(n,o);let a=e.compile_code(o),s=e.get_code_size();if(!s)return null;let c=function(t,n){let r=new Uint8Array(e.memory.buffer,t,n);var o=new WebAssembly.Module(r);const i=new WebAssembly.Global({value:"i32",mutable:!1},65536);return{start_result:(0,(u=new WebAssembly.Instance(o,{sys:{print:e.print,putchar:e.putchar,memory:e.memory,__memory_base:i,__stack_pointer:e.__stack_pointer,setImageData:d},math:{pow:e.pow,log2:e.log2,log:e.log}})).exports._start)(),code_instance:u,code_bytes:t}}(a,s);return r&&e.free(a),c}function y(t,r){let o=e.malloc(1024);f(t,o);let i=e.compile_code(o),a=e.get_code_size();if(!a)return;let s=new Uint8Array(e.memory.buffer,i,a);n(147).writeFileSync(r,s,"binary"),e.free(i)}})(function(){var t,e;function n(){return new DataView(t.buffer)}return{setEnv:function(n,r){t=n,e=r},environ_sizes_get:function(t,e){var r=n();return r.setUint32(t,0,!0),r.setUint32(e,0,!0),0},args_sizes_get:function(t,e){var r=n();return r.setUint32(t,0,!0),r.setUint32(e,0,!0),0},fd_prestat_get:function(t,e){return 8},fd_fdstat_get:function(t,e){var r=n();function o(t,e,n){var o=e;r.setUint32(n?0:4,o,n),r.setUint32(n?4:0,0,n)}return r.setUint8(e,t),r.setUint16(e+2,0,!0),r.setUint16(e+4,0,!0),o(0,0,!0),o(0,0,!0),0},fd_write:function(r,o,i,a){var s=n(),c=0,l=[];return function(e,n){return Array.from({length:n},(function(n,r){var o=e+8*r,i=s.getUint32(o,!0),a=s.getUint32(o+4,!0);return new Uint8Array(t.buffer,i,a)}))}(o,i).forEach((function(t){for(var e=0;e<t.byteLength;e++)l.push(t[e]);c+=e})),1===r&&e(function(t){var e,n,r,o,i,a;for(e="",r=t.length,n=0;n<r;)switch((o=t[n++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(o);break;case 12:case 13:i=t[n++],e+=String.fromCharCode((31&o)<<6|63&i);break;case 14:i=t[n++],a=t[n++],e+=String.fromCharCode((15&o)<<12|(63&i)<<6|(63&a)<<0)}return e}(l)),s.setUint32(a,c,!0),0},fd_prestat_dir_name:function(t,e,n){return 28},environ_get:function(t,e){return 0},args_get:function(t,e){return 0},poll_oneoff:function(t,e,n,r){return 52},proc_exit:function(t){return 52},fd_close:function(t){return 52},fd_seek:function(t,e,n,r){}}}(),"/mw.wasm",c,0,(function(t,e,n){let r=document.getElementById(o.canvas_id);if(!r)return;let i=r.getContext("2d");if(!i)return;r.width=e,r.height=n;let a=i.createImageData(e,n);a.data.set(t),i.putImageData(a,0,0)})).then((t=>{!function(t,e){let n=document.getElementById("version");n&&(n.textContent=e)}(0,(o=t).version)})),window.onload=function(){document.querySelectorAll("button[data-run]").forEach((t=>{let e=t;e.addEventListener("click",(t=>{!function(t){let e=t+"_result",n=t+"_graph_result";(function(t,e){let n=document.getElementById(t),r=document.getElementById(e);if(n&&(n.textContent=""),!r)return;const o=r.getContext("2d");o&&o.clearRect(0,0,r.width,r.height)})(e,n),null!=i&&null!=i.code_bytes&&(0,o.mw_instance.exports.free)(i.code_bytes);let r=document.getElementById(t).value;o.canvas_id=n,o.text_id=e,c((i=o.run_code(r,!1)).start_result),a&&(a.init(),s())}(e.dataset.run||"")}))}));var t=document.getElementById("code");if(!t)return;t.addEventListener("keydown",(function(e){if("Tab"==e.key){e.preventDefault();let n=t.selectionStart||0,r=t.selectionEnd||0;t.value=t.value.substring(0,n)+"\t"+t.value.substring(r),t.selectionStart=t.selectionEnd=n+1}}));var e=document.getElementById("backward"),n=document.getElementById("forward");e.addEventListener("click",(function(){a&&a.backward()})),n.addEventListener("click",(function(){a&&a.forward()}));let r=document.getElementById("canvas_container");r&&(a=function(t,e,n,r,o,i,a,s){function c(t){l.x=t.clientX,l.y=t.clientY}var l={x:0,y:0,startX:0,startY:0},u=null,f=a,d=s,m=n,y=r,_=o,p=i,g=!1,x={history:Array(),cur_pos:-1,init:function(){g=!0,x.history=[],x.cur_pos=-1,h()},backward:function(){x.cur_pos>0&&(x.cur_pos-=1,v())},forward:function(){x.cur_pos<x.history.length-1&&(x.cur_pos+=1,v())}};function h(){let t=x.history.length-1-x.cur_pos;for(let e=0;e<t;e++)x.history.pop();x.history.push({x0:m,y0:y,x1:_,y1:p}),x.cur_pos+=1}function v(){let t=x.history[x.cur_pos];m=t.x0,y=t.y0,_=t.x1,p=t.y1,e(m,y,_,p)}function w(e){c(e),l.startX=l.x,l.startY=l.y,(u=document.createElement("div")).className="rectangle",u.style.left=l.x+"px",u.style.top=l.y+"px",t.appendChild(u),t.style.cursor="crosshair"}function b(t){if(c(t),null!==u){u.style.width=Math.abs(l.x-l.startX)+"px",u.style.height=Math.abs(l.y-l.startY)+"px";let t=l.x<l.startX?l.x:l.startX,e=l.y<l.startY?l.y:l.startY;t+=window.pageXOffset,e+=window.pageYOffset,u.style.left=t+"px",u.style.top=e+"px"}}function z(n){if(!u)return;t.removeChild(u),u=null,t.style.cursor="default";var r=t.getBoundingClientRect(),o=Math.min(l.startX,l.x)-r.left,i=Math.min(l.startY,l.y)-r.top,a=Math.max(l.startX,l.x)-r.left,s=Math.max(l.startY,l.y)-r.top,c=(_-m)/f,g=(p-y)/d;let x=m,v=y;m=x+c*o,y=v+g*i,_=x+c*a,p=v+g*s,h(),e(m,y,_,p)}return t.onmousemove=b,t.ontouchmove=function(t){1==t.touches.length&&b(t.touches[0])},t.ontouchstart=function(t){1==t.touches.length&&w(t.touches[0])},t.ontouchend=function(t){z()},t.onclick=function(e){g&&(3!=e.which?null!==u?z():w(e):u&&(t.removeChild(u),u=null))},x}(r,(function(t,e,n,r){(0,i.code_instance.exports.plot_mandelbrot_set)(t,e,n,r),s()}),-2,-1.2,1,1.2,400,300)),s(),t.value='print "plot a mandelbrot set"\n\nlet plot_mandelbrot_set x0:f64 y0:f64 x1:f64 y1:f64 =\n\tlet width = 400, height = 300\n\tvar a:u8[height][width * 4]\n\tlet scalex = (x1-x0)/width, scaley = (y1-y0)/height, max_iter = 510\n\tvar v = 0.0, r = 0.0, g = 0.0, b = 0.0\n\tfor x in 0..width\n\t\tfor y in 0..height\n\t\t\tlet cx = x0 + scalex*x\n\t\t\tlet cy = y0 + scaley*y\n\t\t\tvar zx = 0.0, zy = 0.0\n\t\t\tvar zx2 = 0.0, zy2 = 0.0\n\t\t\tvar n = 0\n\t\t\twhile n<max_iter && (zx2 + zy2) < 4.0\n\t\t\t\tzy = 2.0 * zx * zy + cy\n\t\t\t\tzx = zx2  - zy2 + cx\n\t\t\t\tzx2 = zx * zx\n\t\t\t\tzy2 = zy * zy\n\t\t\t\tn++\n\t\t\tif n < max_iter then\n\t\t\t\tv = (log(n+1.5-(log2((log(zx2+zy2))/2.0))))/3.4\n\t\t\t\tif v < 1.0 then \n\t\t\t\t\tr = v ** 4;g = v ** 2.5;b = v\n\t\t\t\telse\n\t\t\t\t\tv = v < 2.0 ? 2.0 - v : 0.0\n\t\t\t\t\tr = v;g = v ** 1.5;b = v ** 3.0\n\t\t\ta[y][4*x] = n == max_iter ? 0 : (u8)(r * 255)\n\t\t\ta[y][4*x+1] = n == max_iter ? 0 : (u8)(g * 255)\n\t\t\ta[y][4*x+2] = n == max_iter ? 0 : (u8)(b * 255)\n\t\t\ta[y][4*x+3] = 255\n\n\tsetImageData a width height\n\nplot_mandelbrot_set (-2.0) (-1.2) 1.0 1.2\n'}})(),m=r})();
//# sourceMappingURL=main.bundle.js.map